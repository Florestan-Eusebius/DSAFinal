期末作业: 演员的小世界
===================
> 王逸飞 北京大学物理学院
[TOC]
## 代码说明

共四个自定义类, 作用和成员见代码注释.

```Python
class Film:
    """
    电影类, 存储id, 标题, 年份, 类型, 星级等信息
    """

class Vertex:
    """
    节点类, 以演员为节点. 类成员包括:
    - 演员姓名(str)
    - 共同出演者(共同出演者(key, Vertex)和共同出演的电影(value, List[Film])构成的字典
    - 演员出演的电影字典(key: Film.id, Value: Film)
    - 用于广度优先搜索的参量
    - 用于建立队列的参量
    """

class Graph:
    """ 
    图类. 含有如下成员:
    - 包含所有节点的字典(以演员名字为key, 以演员节点为value)
    - 节点数
    - 连通分支, list(dict(演员姓名: 演员节点)), 每一个字典对应一个连通分支, 按大小排序
    """

class Queue:
    """ 队列类, 用于bfs """
```

构建图的思路为从``json``文件中读取一个个电影条目, 遍历这些条目建图. 从单个条目添加节点和边的函数如下:

```python
def addFromItem(self, item):
    """ 从一个电影条目item中添加节点和边 """
    actors = item['actor'].split(',')  # 获取这个电影的演员列表
    n = len(actors)
    film = Film(item)  # 从条目构建电影
    for i in range(n):  # 遍历参与这个电影的所有演员
        v = self.addVertex(actors[i])  # 添加演员节点
        v.addFilm(film)  # 为节点添加电影
        for j in range(i):  # 遍历参与这个电影的, 当前这个演员之前的演员
            self.addEdge(actors[j], actors[i], film)  # 在两个演员之间添加边
```

## 运行结果

下面直接导入``fin.py``输出到``output.md``文件中的结果.

@import "output.md"

## 其他发现

### 一个小坑
``json``文件里面存在一个重大的小错误, 就是有的电影演员列表里出现了连续的逗号',', 这会导致切片出一个空演员来. 另外有一些电影没有演员, 如果不排除空演员, 那么所有没有演员的电影(1920个)会和出现连续逗号错误的电影都成为某个连通分支里的边, 导致连通分支的数量以及部分连通分支的规模计算错误. 起初我没有注意到这一点, 算出来的连通分支数目是4577, 最大连通分支个数为84687. 根据我在群里的观察, 这个错不止我一个人犯过.

### 